# sdl-fakeqwerty

This makes it so that your keyboard looks like a US-QWERTY keyboard to SDL 2.0 games, while not changing any system settings.  This means that games that use `SDL_Keycode` (`event.keysym.sym`) instead of `SDL_Scancode` (`event.keysym.scancode`) will instead get Keycodes that are similar to what is generated by a US-QWERTY keyboard.

In effect, if you're using a non-QWERTY keyboard, it means these games will have keyboard shortcuts with the same physical positions as a QWERTY keyboard.  eg: `W A S D` bindings become `Comma A O E` on US-Dvorak, or `Z Q S D` on a French AZERTY keyboard.

This works by using Linux's `LD_PRELOAD` mechanism to intercept calls to `SDL_PollEvent` and rewriting the events before the program recieves them.  This way, the event rewriting is limited to just 1 game.

> **Note:** This will only work on Linux systems, as it relies on `LD_PRELOAD` to work.  I don't have interest in porting this code to other platforms.

I've only tested the code with Prison Architect.  It might fix some other games as well.

This code is released under the zlib license (the same terms as the open source SDL 2.0 release).

## Building (generic)

Make sure you have the `libsdl2-dev` package installed, as well as a compiler toolchain.

Building is as simple as running `make`.

## Setting up

### Prison Architect

Prison Architect keybindings suffer this problem.  According to the [public forums](http://forums.introversion.co.uk/viewtopic.php?t=19330) and the (private) bug tracker, the issue is known but a fix doesn't look like it an official fix will ever come.

With this library loaded, text fields still work correctly (in your native layout, not QWERTY).

Copy the compiled `sdl2-hooks.so` file into `SteamLibrary/SteamApps/common/Prison Architect`.

Then edit the shell script `PrisonArchitect` in this directory, and go to the end of the file.

If you are running on an `x86_64` (AMD64 / Intel 64) system, change:

```sh
    "$base"/PrisonArchitect.x86_64 "$@"
```

to:

```sh
    LD_PRELOAD=./sdl2-hooks.so "$base"/PrisonArchitect.x86_64 "$@"
```

If you are running on an `i686` / `ia32` (Intel/AMD 32-bit) system, change:

```sh
    "$base"/PrisonArchitect.i686 "$@"
```

to:

```sh
    LD_PRELOAD=./sdl2-hooks.so "$base"/PrisonArchitect.i686 "$@"
```

Then run Prison Architect through Steam as normal.

## Other games

In order to activate this library, copy `sdl2-hooks.so` into the game's folder, then run the game with the additional environment variable:

```
LD_PRELOAD=./sdl2-hooks.so ./exampleGameBinary
```

This will only work with games that dynamically link to SDL 2.0.  This won't work if the game statically links SDL, or with older versions of SDL.  You can check this by running `ldd` on the binary:

```
$ ldd ./exampleGameBinary | grep -i sdl
	libSDL2-2.0.so.0 => /mnt/raid1/SteamLibrary/SteamApps/common/example/./lib64/libSDL2-2.0.so.0 (0x0000xxxxxxxxxxxx)
```

It doesn't matter if the game supplies its own SDL library.

